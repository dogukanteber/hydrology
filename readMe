The permaFoam package contains the sources of the permaFoam solver and a test case for this solver, along with some related additional information. It includes the following directories and files:

readMe                        - This file contains a brief description of the permafoam package.

Orgogozo_et_al_PPP_2019_Appendix_S1.pdf
                              - This file contains the equations that are solved by the permaFoam solver.

permaFoam/                    - This directory contains the sources of the permaFoam solver.
   createFields.H             - In this file the main fields and variables are defined. 
   readPicardControls.H       - In this file the reading of the parameters of the Picard loops is done.
   permaFoam.C                - This is the main source file of the permaFoam solver.
   setDeltaT.H                - In this file the adaptive time stepping procedure is implemented.
   Make/                      - This directory contains information for the compilation of the solver.
      Files                   - This file contains the path to the sources which need to be compiled to obtain the executable RichardsFoam2.
      options                 - This file contains compilation options for the compilling of the RichardsFoam2 solver.


permaFoam_demoCase/           - This directory contains an demonstration case for the permaFoam solver. It simulates the thaw (thawingBank
                                directory) and freeze (freezingBank directory) of a 1m thick, 10m long initially frozen loam slope
                                (incline: 10%). The thawing phase last 4 months while the freezing phase last 8 months. The details of this
                                case may be found in 'permaFoam_demoCase.pdf' file.
   permaFoam_demoCase.pdf     - This file contains detailled explications on this demonstration case (geometrical and physical features,
                                scripts comments, obtained results).
   mainCommandsClean          - This file lists the command lines that allow to clean all the case directories once the whole case has been ran.
   mainCommandsRun            - This file lists the command lines that allow to run the whole permaFoam_demoCase case.
   thawingBank/               - This directory contains the case that simulates the thawing of the considered initially frozen bank of loam.
      commandsClean           - This file lists the command lines that allow to clean the thawingBank directory once the thawing part of the
                                permaFoam_demoCase has been ran.
      commandsRun             - This file lists the command lines that allow to run the thawing part of permaFoam_demoCase case.
      0/                      - This directory contains the data fields (primary and derived variables, medium properties, forcings) at the
                                initial time of the case.
         AET                  - This file contains the field of actual evapotranspiration rate - computed along resolution [s-1].
         alpha                - This file contains the field of the inverse of the capillary length - input data, not recomputed [m-1].
         Cthsoil              - This file contains the field of the soil heat capacity - input data, not recomputed [kg.m-1.s-2.K-1].
         err                  - This file contains the picard loop residual field for Richards equation - computed along resolution [m]. 
         errT                 - This file contains the picard loop residual field for thermal equation - computed along resolution [K]. 
         gradT                - This file contains the field of temperature gradient projected on cell faces - computed along resolution
                                [K.m-1].
         K                    - This file contains the field of saturated hydraulic conductivity - input data, not recomputed [m.s-1].
         KrThMin              - This file contains the field of minimal frozen relative hydraulic conductivity - input data, not recomputed [-].
         Kthsoil              - This file contains the field of soil thermal conductivity - input data, not recomputed [kg.m.s-3.K-1] 
         n                    - This file contains the field of the van Genuchten exponent - input data, not recomputed [m-1].
         omega                - This file contains the power law factor for the freezing impedance factor for frozen relative hydraulic 
                                conductivity [-].
         PET                  - This file contains the potential evapotranspiration rate field - input data, not recomputed [s-1].
         psi                  - This file contains the water pressure field at cell centers - this is the primary variable of resolution of
                                Richards equation [m].
         psi_F                - This file contains the water pressure field at the centers of cell faces - computed along resolution [m].
         S                    - This file contains the field of storage coefficient - input data, not recomputed [m-1].
         T                    - This file contains the temperature field at cell centers - this is the primary variable of resolution of thermal
                                equation [K].
         T_F                  - This file contains the temperature field at the centers of cell faces - computed along resolution [m].
         theta                - This file contains the water volume fraction field - computed along resolution [-].
         thetag               - This file contains the ice volume fraction field - computed along resolution [-].
         thetal               - This file contains the liquid water volume fraction field - computed along resolution [-].
         thetar               - This file contains the field of residual water saturation - input data, not recomputed [-].
         thetas               - This file contains the field of maximum water saturation - input data, not recomputed [-].
         Tmelt                - This file contains the field of temperature of starting of freezing of the water in the porous medium - input
                                data, not recomputed [K].
         Tvisu                - This file contains the temperature field in degree celsius at cell centers - computed along resolution [K].
                                equation [K].
         U                    - This file contains the water velocity field, normal to cell faces - computed along resolution [m/s].
         Uvol                 - This file contains the water velocity vector field, at cell centers - computed along resolution [m/s].
         usf                  - This file contains a dimensionned unit scalar field [m].
         vuz                  - This file contains a dimensionless vertical upward unit vector field [-].
         W                    - This file contains the field of scaling parameter of the freezing curve of the soil - input data, not 
                                recomputed [K].
      constant/               - This directory contains information about the domain of resolution.          
         transportProperties  - This file contains several non spatialised input data (dimensionning factor, air, liquid water and ice thermal
                                properties, forced bounds for the temperature field).
      polyMesh/               - This directory contains information about the mesh.
         blockMeshDict        - This file contains the input data needed by blockMesh to build the mesh.
      system/                 - This directory contains information about the resolution.
         controlDict          - This file contains the controlling parameters for the transient resolution, output data, ...
         fvSchemes            - This file contains the information for the building of the linear systems involved in the resolution.
         fvSolution           - This file contains the information for the solving of the linear systems involved in the resolution.
         mapFieldsDict        - This file contains the input data needed by the mapFields utility in order to perform field mapping.
   freezingBank/              - This directory contains the case that simulates the freezing of the considered bank of loam, which have thawed
                                previously for 4 month (thawingBank case detailled above).
      commandsClean           - This file lists the command lines that allow to clean the thawingBank directory once the thawing part of the
                                permaFoam_demoCase has been ran.
      commandsRun             - This file lists the command lines that allow to run the thawing part of permaFoam_demoCase case.
      10368000/               - This directory contains the data fields (primary and derived variables, medium properties, forcings) at the
                                initial time of the case (which corresponds to the final time of the thawingBank case).
         AET                  - This file contains the field of actual evapotranspiration rate - computed along resolution [s-1].
         alpha                - This file contains the field of the inverse of the capillary length - input data, not recomputed [m-1].
         Cthsoil              - This file contains the field of the soil heat capacity - input data, not recomputed [kg.m-1.s-2.K-1].
         err                  - This file contains the picard loop residual field for Richards equation - computed along resolution [m]. 
         errT                 - This file contains the picard loop residual field for thermal equation - computed along resolution [K]. 
         gradT                - This file contains the field of temperature gradient projected on cell faces - computed along resolution
                                [K.m-1].
         K                    - This file contains the field of saturated hydraulic conductivity - input data, not recomputed [m.s-1].
         KrThMin              - This file contains the field of minimal frozen relative hydraulic conductivity - input data, not recomputed [-].
         Kthsoil              - This file contains the field of soil thermal conductivity - input data, not recomputed [kg.m.s-3.K-1] 
         n                    - This file contains the field of the van Genuchten exponent - input data, not recomputed [m-1].
         omega                - This file contains the power law factor for the freezing impedance factor for frozen relative hydraulic 
                                conductivity [-].
         PET                  - This file contains the potential evapotranspiration rate field - input data, not recomputed [s-1].
         PET.org              - Saving of the previous file, to be used in scripts involving mapping operations (with mapFields utility).
         psi                  - This file contains the water pressure field at cell centers - this is the primary variable of resolution of
                                Richards equation [m].
         psi_F                - This file contains the water pressure field at the centers of cell faces - computed along resolution [m].
         S                    - This file contains the field of storage coefficient - input data, not recomputed [m-1].
         T                    - This file contains the temperature field at cell centers - this is the primary variable of resolution of thermal
                                equation [K].
         T_F                  - This file contains the temperature field at the centers of cell faces - computed along resolution [m].
         theta                - This file contains the water volume fraction field - computed along resolution [-].
         thetag               - This file contains the ice volume fraction field - computed along resolution [-].
         thetal               - This file contains the liquid water volume fraction field - computed along resolution [-].
         thetar               - This file contains the field of residual water saturation - input data, not recomputed [-].
         thetas               - This file contains the field of maximum water saturation - input data, not recomputed [-].
         Tmelt                - This file contains the field of temperature of starting of freezing of the water in the porous medium - input
                                data, not recomputed [K].
         Tvisu                - This file contains the temperature field in degree celsius at cell centers - computed along resolution [K].
                                equation [K].
         U                    - This file contains the water velocity field, normal to cell faces - computed along resolution [m/s].
         Uvol                 - This file contains the water velocity vector field, at cell centers - computed along resolution [m/s].
         usf                  - This file contains a dimensionned unit scalar field [m].
         vuz                  - This file contains a dimensionless vertical upward unit vector field [-].
         W                    - This file contains the field of scaling parameter of the freezing curve of the soil - input data, not 
                                recomputed [K].
      constant/               - This directory contains information about the domain of resolution.          
         transportProperties  - This file contains several non spatialised input data (dimensionning factor, air, liquid water and ice thermal
                                properties, forced bounds for the temperature field).
      polyMesh/               - This directory contains information about the mesh.
         blockMeshDict        - This file contains the input data needed by blockMesh to build the mesh.
      system/                 - This directory contains information about the resolution.
         controlDict          - This file contains the controlling parameters for the transient resolution, output data, ...
         fvSchemes            - This file contains the information for the building of the linear systems involved in the resolution.
         fvSolution           - This file contains the information for the solving of the linear systems involved in the resolution.
         mapFieldsDict        - This file contains the input data needed by the mapFields utility in order to perform field mapping.


################################################################################################################################################

INSTALLATION.

OpenFOAM (tested version v1906) and swak4Foam* need to be installed on your computer to use the permaFoam solver and run the permaFoam demaonstration case.

In order to compile the permaFoam solver (see Orgogozo et al. PPP 2019 for details), you need to copy the directory "permaFoam" (contained in the present package) into the "applications/solvers/" directory of your OpenFOAM workspace (create these directories if they do not already exist in your openfoam workspace), and then type the command "wmake" from within the "permaFoam" directory. This will compile the solver.


TESTING

To test the solver permaFoam, run the demonstration case permaFoam_demoCase. Copy the directory "permaFoam_demoCase" into the "run/" directory of your OpenFOAM workspace (create it if it does not already exist). There is a file called "mainCommandsRun" within the "permaFoam_demoCase" directory, this file contains all the commands that need to be executed in order to run the demonstration case, once the permaFoam solver has been compiled. 
If you execute these commands ('source mainCommandsRun'), you will firstly go within the thawingBank case directory, then create the mesh in this case (blockMesh), run the solver (permaFoam) and make the postprocessing (funkyDoCalc); then you will move to the freezingBank case directory, create the mesh in this case (blockMesh), map the results of the last time step of the thawingBank case to the initial time step of the freezingBank case (mapFields), run the solver (permaFoam) and make the postprocessing (funkyDoCalc). You will obtain in each subcase (thawingBank and freezingBank) some results in terms of averaged pressure heads, temperature, total water content, liquid water content, and ice content (in files called respectively resPsi, resT, resTheta, resThetal, resThetag), in terms of water fluxes at the boundaries (in files called resFluxBottom, resFluxDownSlope, resFluxTop, resFluxUpSlope), and, of course, in terms of all the output fields at each time of writting of the results, which will be contained in the time directories (named along the associated time coordinate). The whole output data may be visualised by using the paraFoam utility (type the command 'paraFoam' from within the sub-case under consideration, either thawingBank or freezingBank).

* https://openfoamwiki.net/index.php/Installation/swak4Foam/Downloading#swak4Foam_development_version
  At the time of writting, the development version of swak4foam should be used for compatibility reasons with OpenFOAM-v1906

